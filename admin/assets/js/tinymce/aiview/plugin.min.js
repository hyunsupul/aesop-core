!function(a){tinymce.PluginManager.add("aiview",function(b){function c(a){return a.replace(/(\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]([^\[\]]+)\[\/aesop_[a-zA-Z_]+]|\[aesop_([a-zA-Z_]+)\s?([^\[\]]*)])/g,function(a){return e("aesop-component",a)})}function d(a,b){var c;switch(a){case"parallax":case"video":case"document":case"image":c=b.caption;break;case"gallery":c="id:"+b.id;break;case"character":c=b.name;break;case"timeline_stop":case"chapter":case"audio":case"collection":c=b.title;break;case"quote":c=b.quote}return void 0===c?"":c}function e(a,b){var c=/\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]([^\[\]]+)\[\/aesop_[a-zA-Z_]+]/g,e=/\[aesop_([a-zA-Z_]+)\s?([^\[\]]*)]/g,f=/(<\/p>[\s]*<p><\/p>\s<p>)[\s]*$/,g=/(<\/p>[\s]*<p>)[\s]*$/,h=c.exec(b);if(h){var j=i(h),k=d(h[1],j);h[3]=h[3].replace(f,""),h[3]=h[3].replace(g,"");var l='<div data-mce-resize="false" data-mce-placeholder="1" data-aesop-sc="'+window.encodeURIComponent(b)+'" class="mceItem aesop-component-long '+a+'"><div class="aesop-component-mask mceNonEditable unselectable" contenteditable="false"></div><div class="aesop-component-bar" contenteditable="false"><div class="aesop-component-controls"><div title="Delete Component" class="aesop-button aesop-button-delete">&nbsp;</div><div title="Clone Component" class="aesop-button aesop-button-clone">&nbsp;</div><div title="Edit Component" class="aesop-button aesop-button-edit aesop-scope-'+h[1]+'">&nbsp;</div><div title="Cut Component / CTRL + ALT + ENTER to Paste" class="aesop-button aesop-button-clipboard">&nbsp;</div></div><span class="mceNonEditable aesop-component-title unselectable aesop-'+h[1]+'-title">'+h[1].replace(/_/g," ")+"<div style='font-size:75%;padding-left:2.3em;'> "+k+'</div></span></div><div class="aesop-component-content aesop-'+h[1]+'"><p>'+h[3]+"</p></div></div>"}else{h=e.exec(b);var j=i(h),k=d(h[1],j),l='<div data-mce-resize="false" data-mce-placeholder="1" data-aesop-sc="'+window.encodeURIComponent(b)+'" class="mceItem aesop-component-short '+a+'"><div class="aesop-component-mask mceNonEditable unselectable" contenteditable="false"></div><div class="aesop-component-bar" contenteditable="false"><div class="aesop-component-controls"><div title="Delete Component" class="aesop-button aesop-button-delete">&nbsp;</div><div title="Clone Component" class="aesop-button aesop-button-clone">&nbsp;</div><div title="Edit Component" class="aesop-button aesop-button-edit aesop-scope-'+h[1]+'">&nbsp;</div><div title="Cut Component / CTRL + ALT + ENTER to Paste" class="aesop-button aesop-button-clipboard">&nbsp;</div></div><div class="mceNonEditable aesop-component-title unselectable aesop-'+h[1]+'-title">'+h[1].replace(/_/g," ")+"<div style='font-size:75%;padding-left:2.3em;'>"+k+'</div></div></div><div class="aesop-end">WcMgcq</div></div>'}return l}function f(a){return a.replace(/<div[^>]+?class="[^"]+?aesop-component-long.*?aesop-sc="([^"]+)"[\s\S]*?aesop-component-content[^>]*?>(.*?)<\/div>[\s]*?<\/div>|<div class="[^"+]+?aesop-component-short.*?aesop-sc="([^"]+)"[\s\S]*?WcMgcq<\/div><\/div>/g,function(a){return g(a)})}function g(a){var b=/<div[^>]+?class="[^"]+?aesop-component.*?aesop-sc="([^"]+)"[\s\S]*?aesop-component-content[^>]*?>(.*?)<\/div>[\s]*?<\/div>/g,c=/<div class="[^"+]+?aesop-component.*?aesop-sc="([^"]+)"[\s\S]*?WcMgcq<\/div><\/div>/g,d=/<div\s*class="clipboardControl[^>]+?><div\s*class="aesop[^>]+>\s*<\/div><\/div>/g;a=a.replace(d,"");var e=b.exec(a);if(e){var f=window.decodeURIComponent(e[1]),g=/\[[^\]]*\]([^\[]*)[^\]]*\]/,h=g.exec(f);return null!=h&&(e[2]=e[2].replace(/^<p>\W<\/p>/,""),f=f.replace(h[1],e[2])),"<p>"+f+"</p>"}if(!(e=c.exec(a)))return a;var f=window.decodeURIComponent(e[1]);return"<p>"+f+"</p>"}function h(a){var b={"&lt;":"<","&gt;":">","&#91;":"[","&#93;":"]","&#34;":'"'};return a.replace(/&lt;|&gt;|&#91;|&#93;|&#34;/g,function(a){return b[a]||a})}function i(a){var b=/\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]([^\[\]]+)\[\/aesop_[a-zA-Z]+]/g,c=/\[aesop_([a-zA-Z_]+)\s([^\[\]]*)]/g,d=/<br data-mce-bogus="1">/g,e=/([^\s]+="[^"]+")/g,f=b.exec(a);if(!f&&!(f=c.exec(a)))return a;for(var g,i=[];null!==(g=e.exec(f[2]));)i.push(g[1]);var j=[];return i.forEach(function(a){var b=a.split(/=(.+)?/);if(b.length>2){var c=a.indexOf("=");b=[a.slice(0,c),a.slice(c+1)]}var d=b[0],e=b[1];e="floatermedia"!=d&&"overlay_content"!=d?h(e):e.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;"),e=e.replace("<p>","").replace("</p>",""),e=e.slice(0,-1),j[d]=e.substring(1)}),void 0!==f[3]&&(j.content=f[3].replace(d,"")),j}function j(a){"none"!==a.style.display&&(a.style.display="none")}function k(a){"block"!==a.style.display&&(a.style.display="block")}function l(b){window.clipboardSource=b;var c=tinymce.activeEditor,d=c.dom.create("div",{class:"clipboardControl mceNonEditable unselectable"},'<div class="aesop-button aesop-button-paste mceNonEditable unselectable" title="Ctrl + Alt + Enter to Paste">&nbsp;</div>');c.getBody().insertBefore(d,c.getBody().firstChild),window.clipboardControl=a(d)}function m(){var a=tinymce.activeEditor,b=a.dom.select(".clipboardControl");a.dom.remove(b),delete window.clipboard,delete window.clipboardSource,delete window.clipboardControl}function n(){var a=window.clipboardSource,b=tinymce.activeEditor;b.dom.remove(a),k(window.clipboard),b.execCommand("mceInsertRawHTML",!1,window.clipboard.outerHTML),m()}function o(a){tinymce.activeEditor;jQuery(a.outerHTML).insertAfter(a)}jQuery.fn.setCursorPosition=function(b){return 0==this.length?this:a(this).setSelection(b,b)},jQuery.fn.setSelection=function(a,b){if(0==this.length)return this;if(input=this[0],input.createTextRange){var c=input.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}else input.setSelectionRange&&(input.focus(),input.setSelectionRange(a,b));return this},jQuery.fn.focusEnd=function(){return this.setCursorPosition(this.val().length),this},b.onClick.add(function(b,c){if(delete window.ailocked,delete window.aiactive,void 0!==a(b.selection.getNode()).parents(".aesop-component")[0]&&(window.aiactive=!0),c.target.className.indexOf("aesop-button-delete")>-1){confirm("Are you sure you want to delete this Aesop Component?")===!0&&c.target.parentNode.parentNode.parentNode.parentNode.removeChild(c.target.parentNode.parentNode.parentNode),delete window.aiactive,window.ailocked=!0,tinymce.execCommand("mceFocus",!1,b.id)}if(c.target.className.indexOf("aesop-button-edit")>-1){var d=/aesop-scope-([a-z_]*)/,e=d.exec(c.target.className),g=c.target.parentNode.parentNode.parentNode,h=g.getAttribute("data-aesop-sc");if(h?(h=window.decodeURIComponent(h),h="<p>"+h+"</p>"):h=f(g.outerHTML),g.setAttribute("id","aesop-generator-editing"),e){a("body").toggleClass("modal-open"),a("body").addClass("modal-updating"),a("#aesop-generator-wrap").toggleClass("aesop-generator-open");a(".dk_options li."+e[1]+" a").click();var k=i(h);for(var m in k)"content"===m?a("#aesop-generator-content").val(k[m]):a('#aesop-generator-settings [name="'+m+'"]').val(k[m])}tiny_ai_parent=b.dom.select("#aesop-generator-editing")[0],b.selection.select(tiny_ai_parent),b.selection.collapse(!1)}if(c.target.className.indexOf("aesop-button-clipboard")>-1){var g=c.target.parentNode.parentNode.parentNode;window.clipboard=g,j(g),l(g),b.selection.collapse(!1)}if(c.target.className.indexOf("aesop-button-clone")>-1){var g=c.target.parentNode.parentNode.parentNode;o(g),b.selection.collapse(!1)}}),b.onKeyDown.add(function(b,c){if(delete window.ailocked,13===c.keyCode&&!c.ctrlKey&&!c.shiftKey&&!c.altKey){var d=b.selection.getNode(),e=a(d).parents(".aesop-component");if(a(d).parents(".aesop-component")[0]){c.preventDefault(),c.stopPropagation();var f=a("<p><br/></p>").insertAfter(e);f.uniqueId();var g=f.attr("id"),h=b.dom.select("#"+g)[0];b.selection.setCursorLocation(h)}}c.ctrlKey&&c.altKey&&13===c.keyCode&&(c.preventDefault(),c.stopPropagation(),void 0===window.clipboard?alert("Clipboard is empty"):void 0!==window.aiactive?alert("Please do not paste into an existing aesop component"):n())}),b.onKeyUp.add(function(b,c){void 0!==a(b.selection.getNode()).parents(".aesop-component")[0]?window.aiactive=!0:delete window.aiactive}),b.on("BeforeSetContent",function(a){a.content=c(a.content)}),b.on("PostProcess",function(a){a.get&&(a.content=f(a.content))})})}(window.jQuery);
//# sourceMappingURL=plugin.min.js.map